---
import "../styles/global.css";
import DecisionField from "../components/system/DecisionField.astro";

interface Props {
  title?: string;
}

const { title = "Aurora" } = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Aurora. Infraestructura para decisiones críticas." />
    <title>{title}</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  </head>
  <body data-regime="unstable" data-state="unstable" data-algorithm="core">
    <DecisionField />

    <header class="site-header">
      <div class="container-base site-header-inner">
        <a href="/" class="site-brand">
          <img src="/brand/aurora-symbol.png" alt="Aurora" class="brand-symbol" />
          <span class="brand-word">AURORA</span>
        </a>
        <nav class="site-nav" aria-label="Principal">
          <a href="/" class="site-nav-link">AURORA</a>
          <button
            type="button"
            class="site-nav-link site-products-trigger"
            id="site-products-trigger"
            aria-expanded="false"
            aria-controls="site-products-menu"
          >
            Productos
          </button>
          <a href="/demo" class="site-nav-link">Demo</a>
        </nav>
      </div>
      <div class="site-products-menu-wrap">
        <div id="site-products-menu" class="site-products-menu" hidden>
          <p class="site-products-kicker">MOTOR ESTRUCTURAL</p>
          <div class="site-products-list" role="list">
            <button type="button" class="site-product-item" data-product="core" data-group="motor-structural" role="listitem">
              <span class="site-product-name">Core</span>
              <span class="site-product-tech">Orquesta evidencia causal y convergencia en una sola malla activa.</span>
              <span class="site-product-impact">Sostiene decisión ejecutable bajo presión operativa continua.</span>
            </button>
            <button type="button" class="site-product-item" data-product="scenario" data-group="motor-structural" role="listitem">
              <span class="site-product-name">Scenario</span>
              <span class="site-product-tech">Simula rutas condicionales con límites de ejecución y dependencia real.</span>
              <span class="site-product-impact">Expone bifurcaciones críticas antes de comprometer recursos.</span>
            </button>
            <button type="button" class="site-product-item" data-product="risk" data-group="motor-structural" role="listitem">
              <span class="site-product-name">Risk</span>
              <span class="site-product-tech">Prioriza tensiones de fallo por propagación y velocidad sistémica.</span>
              <span class="site-product-impact">Reduce exposición al fijar umbrales de acción verificables.</span>
            </button>
            <button type="button" class="site-product-item" data-product="signal" data-group="motor-structural" role="listitem">
              <span class="site-product-name">Signal</span>
              <span class="site-product-tech">Filtra ruido y retiene señal mínima con trazabilidad temporal.</span>
              <span class="site-product-impact">Acelera foco ejecutivo sin perder contexto causal.</span>
            </button>
            <button type="button" class="site-product-item" data-product="ledger" data-group="motor-structural" role="listitem">
              <span class="site-product-name">Ledger</span>
              <span class="site-product-tech">Registra decisiones, supuestos y evidencia en secuencia auditable.</span>
              <span class="site-product-impact">Conserva memoria institucional durante cambios de régimen.</span>
            </button>
            <button type="button" class="site-product-item" data-product="integration" data-group="motor-structural" role="listitem">
              <span class="site-product-name">Integration</span>
              <span class="site-product-tech">Conecta señales externas al motor sin fragmentar consistencia interna.</span>
              <span class="site-product-impact">Eleva cobertura sin ampliar fricción en el flujo de decisión.</span>
            </button>
          </div>
          <p class="site-products-kicker">Advanced Systems</p>
          <div class="site-products-list" role="list">
            <button
              type="button"
              class="site-product-item"
              data-product="counterfactual"
              data-group="advanced-systems"
              role="listitem"
            >
              <span class="site-product-name">Counterfactual Engine™</span>
              <span class="site-product-tech">Modela rutas alternativas bajo la misma restricción operativa.</span>
              <span class="site-product-impact">Te permite anticipar impacto antes de comprometer ejecución.</span>
            </button>
            <button
              type="button"
              class="site-product-item"
              data-product="regime-shift"
              data-group="advanced-systems"
              role="listitem"
            >
              <span class="site-product-name">Regime Shift Detector™</span>
              <span class="site-product-tech">Detecta cambios de estado cuando la señal aún es marginal.</span>
              <span class="site-product-impact">Te muestra cuándo un supuesto dejó de sostener la decisión.</span>
            </button>
            <button
              type="button"
              class="site-product-item"
              data-product="decision-entropy"
              data-group="advanced-systems"
              role="listitem"
            >
              <span class="site-product-name">Decision Entropy Map™</span>
              <span class="site-product-tech">Mapea dispersión causal y puntos de tensión en tiempo real.</span>
              <span class="site-product-impact">Te reduce fricción al concentrar foco en el nodo dominante.</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer id="contacto" class="site-footer">Aurora</footer>

    
  



<script is:inline type="module">
  (() => {
    if (window.__auroraNavInit) return;
    window.__auroraNavInit = true;

    const PRODUCT_ALGORITHM = {
      core: "core",
      scenario: "scenario",
      risk: "risk",
      signal: "signal",
      ledger: "ledger",
      integration: "integration",
      counterfactual: "scenario",
      "regime-shift": "risk",
      "decision-entropy": "integration",
    };

    const trigger = document.getElementById("site-products-trigger");
    const menu = document.getElementById("site-products-menu");
    if (!trigger || !menu) return;

    const items = Array.from(menu.querySelectorAll("[data-product]"));
    let isOpen = false;

    const setAlgorithm = (productKey) => {
      document.body.dataset.algorithm = PRODUCT_ALGORITHM[productKey] || "core";
    };

    const setFocus = (productKey, groupKey) => {
      document.body.dataset.productFocus = productKey || "";
      document.body.dataset.groupFocus = groupKey || "";
    };

    const setOpenState = (nextOpen) => {
      isOpen = nextOpen;
      trigger.setAttribute("aria-expanded", nextOpen ? "true" : "false");
      menu.hidden = !nextOpen;
      menu.style.display = nextOpen ? "" : "none";
      if (!nextOpen) {
        items.forEach((item) => item.removeAttribute("data-active"));
        setAlgorithm("");
        setFocus("", "");
      }
    };

    const activateItem = (item) => {
      const key = item.getAttribute("data-product");
      const group = item.getAttribute("data-group");
      items.forEach((node) => node.removeAttribute("data-active"));
      item.setAttribute("data-active", "true");
      setAlgorithm(key);
      setFocus(key, group);
    };

    trigger.setAttribute("aria-haspopup", "menu");
    if (!trigger.hasAttribute("aria-controls")) {
      trigger.setAttribute("aria-controls", "site-products-menu");
    }
    setOpenState(false);

    trigger.addEventListener("click", (event) => {
      event.preventDefault();
      event.stopPropagation();
      setOpenState(!isOpen);
      if (isOpen && items.length > 0) {
        activateItem(items[0]);
      }
    });

    trigger.addEventListener("keydown", (event) => {
      if (event.key === "Enter" || event.key === " ") {
        event.preventDefault();
        setOpenState(!isOpen);
        return;
      }
      if (event.key === "ArrowDown") {
        event.preventDefault();
        if (!isOpen) setOpenState(true);
        if (items.length > 0) items[0].focus();
      }
    });

    document.addEventListener("click", (event) => {
      if (!isOpen) return;
      const target = event.target;
      if (trigger.contains(target) || menu.contains(target)) return;
      setOpenState(false);
    });

    document.addEventListener("keydown", (event) => {
      if (event.key !== "Escape" || !isOpen) return;
      setOpenState(false);
      trigger.focus();
    });

    menu.addEventListener("focusout", () => {
      if (!isOpen) return;
      requestAnimationFrame(() => {
        const active = document.activeElement;
        if (!menu.contains(active) && active !== trigger) {
          setOpenState(false);
        }
      });
    });

    items.forEach((item) => {
      item.addEventListener("mouseenter", () => activateItem(item));
      item.addEventListener("focus", () => activateItem(item));
      item.addEventListener("click", () => activateItem(item));
    });
  })();
</script>

</body>
</html>
